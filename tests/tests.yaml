# A test is structured as follows:
# `from` is the original list of tasks
# `to` is the modified list of tasks
# `new` is the expected list of tasks detected as new
# `changes` is a list of TaskDelta<Vec<String>> that describes the expected detected
#     changes. For each entry in `from`, a corresponding entry in `changes`
#     will contain an object describing the computed changes.
# Here is an example:
example:
  allowed_divergence: 20
  from:
    - do a thing
    - eat vegetables due:2010-01-01 rec:+1d
    - tell all my friends about todo.txt t:2010-02-01

  to:
    - x do a thing
    - do another thing
    - tell all my friends all about todo.txt t:2010-02-06
    - x eat vegetables due:2010-01-01 rec:+1d
    - x eat vegetables due:2010-01-02 rec:+1d

  new:
    - do another thing

  changes:
    - Changed: # do a thing
      - Finished(true)
    - Recurred: # eat vegetables due:2010-01-01 rec:+1d
      - # x eat vegetables due:2010-01-01 rec:+1d
        - Finished(true)
      - # x eat vegetables due:2010-01-02 rec:+1d
        - RecurredStrict
        - Finished(true)
    - Changed: # tell all my friends about todo.txt t:2010-02-01
      - ThresholdDate(Some(2010-02-01), Some(2010-02-06))
      - Subject("tell all my friends about todo.txt", "tell all my friends all about todo.txt")


do_nothing:
  from:
    - do a thing
    - do another thing

  to:
    - do another thing
    - do a thing

  new: []

  changes:
    - Identical
    - Identical

do_nothing_repeated:
  from:
    - do a thing
    - do a thing
    - do a thing

  to:
    - do a thing
    - do a thing
    - do a thing

  new: []

  changes:
    - Identical
    - Identical
    - Identical

new:
  from:
    - do a thing

  to:
    - do a thing
    - do another thing

  new:
    - do another thing

  changes:
    - Identical

delete:
  from:
    - do a thing

  to:
    - what is this ?

  new:
    - what is this ?

  changes:
    - Deleted

copy:
  from:
    - do a thing

  to:
    - do a thing
    - do a thing

  new:
    - do a thing

  changes:
    - Identical

copy_and_finish:
  from:
    - do a thing

  to:
    - x do a thing
    - x do a thing

  new:
    - x do a thing

  changes:
    - Changed:
      - Finished(true)

change_subject_and_finish:
  allowed_divergence: 40
  from:
    - do a thing

  to:
    - do an thing
    - x do a thing

  new:
    - do an thing

  changes:
    - Changed:
      - Finished(true)

change_subject:
  allowed_divergence: 40
  from:
    - do a thing
    - eat a hamburger

  to:
    - drink a hamburger
    - do an thing

  new: []

  changes:
    - Changed:
      - Subject("do a thing", "do an thing")
    - Changed:
      - Subject("eat a hamburger", "drink a hamburger")

# TODO: Unwanted behaviour
simple_strict_recurrence:
  allowed_divergence: 50
  from:
    - 2018-04-08 foo due:2018-04-08 rec:1d

  to:
    - x 2018-04-08 2018-04-08 foo due:2018-04-08 rec:1d
    - 2018-04-08 foo due:2018-04-10 rec:1d
    - x 2018-04-08 2018-04-08 foo due:2018-04-09 rec:1d
    - 2018-04-08 bar

  new:
    - 2018-04-08 bar

  changes:
    - Recurred:
      -
        - FinishedAt(2018-04-08)
      -
        - Copied
        - "PostponedStrictBy(Duration { secs: 172800, nanos: 0 })"
      -
        - RecurredFrom(2018-04-08)
        - FinishedAt(2018-04-08)

# TODO: Unwanted behaviour
recurrence_and_postponing:
  allowed_divergence: 50
  from:
    - 2018-06-01 foo due:2018-06-20 rec:1m

  to:
    - x 2018-06-17 2018-06-01 foo due:2018-06-15 rec:1m
    - 2018-06-17 foo due:2018-07-15 rec:1m

  new: []

  changes:
    - Recurred:
      -
        - FinishedAt(2018-06-17)
        - "PostponedStrictBy(Duration { secs: -432000, nanos: 0 })"
      -
        - Copied
        - "PostponedStrictBy(Duration { secs: 2160000, nanos: 0 })"
        - CreateDate(Some(2018-06-01), Some(2018-06-17))
